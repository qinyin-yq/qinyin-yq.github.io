<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="技术总结">
<meta property="og:type" content="website">
<meta property="og:title" content="秦音">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="秦音">
<meta property="og:description" content="技术总结">
<meta property="article:author" content="YouQiang">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>秦音</title>
  








<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">秦音</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">个人博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archive">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/22/Elasticsearch%E5%BF%AB%E7%85%A7%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YouQiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秦音">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/22/Elasticsearch%E5%BF%AB%E7%85%A7%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F/" itemprop="url">Elasticsearch快照备份与还原</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-22T13:55:00+08:00">
                2020-05-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">elasticsearch</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="使用snapshot实现es数据备份、还原与迁移"><a href="#使用snapshot实现es数据备份、还原与迁移" class="headerlink" title="使用snapshot实现es数据备份、还原与迁移"></a>使用snapshot实现es数据备份、还原与迁移</h3><h4 id="1-snapshot介绍"><a href="#1-snapshot介绍" class="headerlink" title="1.snapshot介绍"></a>1.snapshot介绍</h4><p>&emsp;&emsp; snapshot api是Elasticsearch用于对数据进行备份和恢复的一组api接口，可以通过snapshot api进行跨集群的数据迁移，原理就是从源ES集群创建数据快照，然后在目标ES集群中进行恢复。需要注意ES的版本问题:<br>&emsp;&emsp; 1)目标ES集群的主版本号(如5.6.4中的5为主版本号)要大于等于源ES集群的主版本号;<br>&emsp;&emsp; 2)1.x版本的集群创建的快照不能在5.x版本中恢复;</p>
<h4 id="2-数据备份"><a href="#2-数据备份" class="headerlink" title="2.数据备份"></a>2.数据备份</h4><p>2.1 源ES集群中创建备份还原目录：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir es_bak</span><br><span class="line"># 为了避免权限问题，直接修改/opt/es_bak权限为777</span><br><span class="line">chmod <span class="number">777</span> /opt/es_bak</span><br></pre></td></tr></table></figure>
<p>2.2 注册备份还原目录<br>&emsp;&emsp; 修改elasticsearch.yml,添加如下配置<code>path.repo: [&#39;/opt/elasticsearch/es_bak&#39;]</code><br>&emsp;&emsp; 即指定备份还原目录路径，然后重启elasticsearch<br>2.3 注册备份还原仓库（仓库名称为my_backup）<br><code>PUT http://地址:9200/_snapshot/my_backup/</code><br>参数：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"fs"</span>,</span><br><span class="line">    <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"location"</span>: <span class="string">"/opt/elasticsearch/es_bak"</span>,</span><br><span class="line">        <span class="attr">"max_snapshot_bytes_per_sec"</span> : <span class="string">"50mb"</span>,</span><br><span class="line">        <span class="attr">"max_restore_bytes_per_sec"</span> : <span class="string">"50mb"</span>,</span><br><span class="line">        <span class="attr">"compress"</span> : <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/es/%E6%B3%A8%E5%86%8C%E5%A4%87%E4%BB%BD%E8%BF%98%E5%8E%9F%E4%BB%93%E5%BA%93.jpg" alt=""><br>查看仓库情况：<code>GET http://地址:9200/_snapshot/my_backup/_all</code><br><img src="/images/es/%E6%9F%A5%E7%9C%8B%E4%BB%93%E5%BA%93%E7%8A%B6%E6%80%81.jpg" alt=""><br>这里执行完之后/opt/elasticsearch/es_bak目录下还什么数据都没有.<br>一个repository仓库可以包含多份快照文件，repository主要有一下几种类型:</p>
<blockquote>
<p>fs: 共享文件系统，将快照文件存放于文件系统中<br> url: 指定文件系统的URL路径，支持协议：http,https,ftp,file,jar<br> s3: AWS S3对象存储,快照存放于S3中，以插件形式支持<br> hdfs: 快照存放于hdfs中，以插件形式支持<br> cos: 快照存放于腾讯云COS对象存储中，以插件形式支持</p>
</blockquote>
<p>2.4 备份数据<br>在创建的my_backup仓库下备份数据，备份的名称为：yq<br><code>PUT http://地址:9200/_snapshot/my_backup/yq</code><br>指定备份的索引逗号分隔，不传默认备份所有索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;indices&quot;: &quot;index1,index2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>?wait_for_completion=true 等待备份完后再返回<br>参数 wait_for_completion 决定请求是在快照初始化后立即返回（默认），还是等快照创建完成之后再返回。<br><img src="/images/es/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD.jpg" alt=""><br>备份完成后可以看到备份状态，该yq备份已经完成，且能查看所备份的索引值：<br><img src="/images/es/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E7%BB%93%E6%9E%9C%E6%9F%A5%E7%9C%8B.jpg" alt=""><br>备份完数据后就会在/opt/es_bak目录下生成备份的元数据：<br><img src="/images/es/%E5%A4%87%E4%BB%BD%E5%85%83%E6%95%B0%E6%8D%AE.jpg" alt=""></p>
<h4 id="3-数据还原"><a href="#3-数据还原" class="headerlink" title="3.数据还原"></a>3.数据还原</h4><p>将步骤2中生成的备份元数据（即/opt/elasticsearch/es_bak目录下的所有文件）拷贝到要还原的目标机器的备份还原目录下。注意：在目标机器上2.1、2.2、2.3三个步骤同样需要进行操作，只是仓库的路径不比与源es仓库路径一样，根据个人情况而定。<br>元数据文件拷贝到目标机器后，在需要还原的机器上执行POST请求：<br><code>POST http://地址:9200/_snapshot/my_backup/yq/_restore</code><br><img src="/images/es/%E6%95%B0%E6%8D%AE%E8%BF%98%E5%8E%9F.jpg" alt=""><br>然后在目标机器上查看es中是否还原该索引数据<br><img src="/images/es/%E7%9B%AE%E6%A0%87%E6%9C%BA%E5%99%A8%E6%95%B0%E6%8D%AE.jpg" alt=""></p>
<h4 id="4-数据迁移"><a href="#4-数据迁移" class="headerlink" title="4.数据迁移"></a>4.数据迁移</h4><p>单节点情况下，数据迁移与数据还原类似，都是将元数据文件拷贝然后还原即可。</p>
<p>参考链接：<br><a href="https://blog.csdn.net/frankcheng5143/article/details/95168300" target="_blank" rel="noopener" title="Elasticsearch快照备份与还原">Elasticsearch快照备份与还原</a><br><a href="https://cloud.tencent.com/developer/article/1409613" target="_blank" rel="noopener" title="es数据备份和恢复">es数据备份和恢复</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/20/Linux%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YouQiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秦音">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/20/Linux%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/" itemprop="url">Linux常用软件安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-20T14:26:00+08:00">
                2020-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-jdk安装"><a href="#1-jdk安装" class="headerlink" title="1.jdk安装"></a>1.jdk安装</h3><h4 id="本地压缩包安装"><a href="#本地压缩包安装" class="headerlink" title="本地压缩包安装"></a>本地压缩包安装</h4><p>1）将jdk的centos7 jar解压到指定位置<br>2）修改环境变量：<code>vi /etc/profile</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-1.8.0-openjdk-1.8.0.181-3.b13.el7_5.x86_64</span><br><span class="line">JRE_HOME&#x3D;$JAVA_HOME&#x2F;jre</span><br><span class="line">PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin</span><br><span class="line">CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar</span><br><span class="line">export JAVA_HOME</span><br><span class="line">export JRE_HOME</span><br><span class="line">export PATH</span><br><span class="line">export CLASSPATH</span><br></pre></td></tr></table></figure>
<p>3）重启系统文件：<code>source /etc/profile</code></p>
<h3 id="2-linux中Expect工具的安装"><a href="#2-linux中Expect工具的安装" class="headerlink" title="2.linux中Expect工具的安装"></a>2.linux中Expect工具的安装</h3><p>Expect是一个用来处理交互的工具，通常用于需要手动输入数据的场景，可在脚本中使用expect来实现自动化。</p>
<p>安装<br>首先查看系统中是否有安装expect。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis expect</span><br></pre></td></tr></table></figure>
<p>Expect工具是依赖tcl的，所以也需要安装tcl。</p>
<p>首先下载并安装tcl，这里安装8.4.19版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;tcl&#x2F;files&#x2F;Tcl&#x2F;8.4.19&#x2F;tcl8.4.19-src.tar.gz</span><br><span class="line">tar zxvf tcl8.4.19-src.tar.gz</span><br><span class="line">cd tcl8.4.19&#x2F;unix &amp;&amp; .&#x2F;configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>然后下载expect并安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;expect&#x2F;files&#x2F;Expect&#x2F;5.45&#x2F;expect5.45.tar.gz</span><br><span class="line">tar zxvf expect5.45.tar.gz</span><br><span class="line">cd expect5.45</span><br><span class="line">.&#x2F;configure --with-tcl&#x3D;&#x2F;usr&#x2F;local&#x2F;lib --with-tclinclude&#x3D;..&#x2F;tcl8.4.19&#x2F;generic</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s &#x2F;usr&#x2F;local&#x2F;bin&#x2F;expect &#x2F;usr&#x2F;bin&#x2F;expect</span><br></pre></td></tr></table></figure>

<p>安装完成之后运行expect命令，查看是否安装成功。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">expect</span><br><span class="line">expect1.1&gt;</span><br></pre></td></tr></table></figure>

<p>expect的基本操作：<br>Expect脚本中常用的命令包括spawn, expect, send, interact等。</p>
<blockquote>
<p>spawn：该命令用于启动一个子进程，执行后续命令；</p>
</blockquote>
<blockquote>
<p>expect：该命令从进程接受字符串，如果接受的字符串和期待的字符串不匹配，则一直阻塞，直到匹配上或者等待超时才继续往下执行；</p>
</blockquote>
<blockquote>
<p>send：向进程发送字符串，与手动输入内容等效，通常字符串需要以’\r’结尾。</p>
</blockquote>
<blockquote>
<p>interact：该命令将控制权交给控制台，之后就可以进行人工操作了。通常用于使用脚本进行自动化登录之后再手动执行某些命令。如果脚本中没有这一条语句，脚本执行完将自动退出。</p>
</blockquote>
<blockquote>
<p>set timeout 30：设置超时时间timeout为30s，expect命令阻塞超时时会自动往下继续执行。将timeout配置为-1时表示expect一直阻塞直到与期待的字符串匹配上才继续往下执行。超时时间timeout默认为10s。</p>
</blockquote>
<blockquote>
<p>[lindex $argv n]：可以在脚本中使用该命令获取在脚本执行时传入的第n个参数。这里argv为传入的参数，另外argv为传入的参数，另外argc表示传入参数的个数，$argv0表示脚本名字。</p>
</blockquote>
<p>另外我们也可以使用[lrange $argv sn en]命令获取第sn到第en个参数。<br>实例解析:这里我们写一个脚本，命名为restart_service.exp，该脚本先切换到指定账户，然后下载软件包到tomcat的webapps目录，然后重启tomcat服务。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;expect</span><br><span class="line"></span><br><span class="line">set timeout -1</span><br><span class="line"></span><br><span class="line">set user [lindex $argv 0]</span><br><span class="line">set password [lindex $argv 1]</span><br><span class="line">set cmd_prompt &quot;# &quot;</span><br><span class="line"></span><br><span class="line">spawn su $&#123;user&#125;</span><br><span class="line">expect $&#123;cmd_prompt&#125;</span><br><span class="line">send &quot;$&#123;password&#125;\r&quot;</span><br><span class="line"></span><br><span class="line">expect $&#123;cmd_prompt&#125;</span><br><span class="line">send &quot;cd &#x2F;opt&#x2F;tomcat&#x2F;webapps &amp;&amp; wget http:&#x2F;&#x2F;host&#x2F;path&#x2F;to&#x2F;package.war\r&quot;</span><br><span class="line">expect &quot;100%&quot;</span><br><span class="line"># 直到wget下载任务打印出100%才表示软件包下载完成</span><br><span class="line"></span><br><span class="line">expect $&#123;cmd_prompt&#125;</span><br><span class="line">send &quot;&#x2F;opt&#x2F;tomcat&#x2F;bin&#x2F;shutdown.sh\r&quot;</span><br><span class="line"></span><br><span class="line">expect $&#123;cmd_prompt&#125;</span><br><span class="line">send &quot;&#x2F;opt&#x2F;tomcat&#x2F;bin&#x2F;startup.sh\r&quot;</span><br><span class="line"></span><br><span class="line">expect eof</span><br><span class="line">#interact</span><br></pre></td></tr></table></figure>

<h3 id="3-sshpass的安装使用"><a href="#3-sshpass的安装使用" class="headerlink" title="3.sshpass的安装使用"></a>3.sshpass的安装使用</h3><p>sshpass下载与安装<br>3.1 yum安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install sshpass</span><br></pre></td></tr></table></figure>
<p>若yum安装不上，则用下面方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;sshpass&#x2F;files&#x2F;</span><br><span class="line">or</span><br><span class="line">https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1pLNxeLd</span><br><span class="line">or</span><br><span class="line">wget http:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;sshpass&#x2F;files&#x2F;latest&#x2F;download -O sshpass.tar.gz</span><br></pre></td></tr></table></figure>
<p>3.2 下载后，解压，安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf sshpass-1.06.tar.gz</span><br><span class="line">cd sshpass-1.06</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>3.3 使用命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshpass -p 123456(密码) scp &#x2F;home&#x2F;file.txt root@10.0.0.37:&#x2F;home&#x2F;copy</span><br></pre></td></tr></table></figure>





          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/14/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YouQiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秦音">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/14/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" itemprop="url">Linux常用命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-14T18:00:00+08:00">
                2020-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="yum"><a href="#yum" class="headerlink" title="yum"></a>yum</h3><h4 id="修改yum的获取地址"><a href="#修改yum的获取地址" class="headerlink" title="修改yum的获取地址"></a>修改yum的获取地址</h4><p>即指定yum从哪个地址上下载指定软件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#备份原始yum相关配置文件</span></span><br><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br><span class="line">mv /etc/yum.repos.d/CentOS-Debuginfo.repo /etc/yum.repos.d/CentOS-Debuginfo.repo.bak</span><br><span class="line"><span class="comment">#添加文件，baseurl指定的就是目标yum路径</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"#matthubin shell script generate this file</span></span><br><span class="line"><span class="string">[aiidc-media]</span></span><br><span class="line"><span class="string">name=aiidc-Media</span></span><br><span class="line"><span class="string">baseurl=http://172.16.16.222/</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">enabled=1"</span> &gt; /etc/yum.repos.d/aiidc.repo</span><br><span class="line"><span class="comment">#清除原来的yum缓存</span></span><br><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line"><span class="comment">#从指定路径中安装nginx</span></span><br><span class="line">yum install nginx</span><br></pre></td></tr></table></figure>
<p><font color=red>注意：yum包管理工具支持centos，而apt-get包管理工具支持ubuntu。</font></p>
<h3 id="rpm"><a href="#rpm" class="headerlink" title="rpm"></a>rpm</h3><p>查看当前rpm包的版本： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#查询哪个包里有nginx这个文件</span><br><span class="line">yum list|grep nginx </span><br><span class="line">#或</span><br><span class="line">rpm -qa|grep 包名 （建议使用）</span><br></pre></td></tr></table></figure>
<p>查看centos7.2系统本身所安装的yum依赖包: <code>rpm -qa|grep yum</code><br>rpm -e如果删不掉可以试试 <code>rpm -e --nodeps 文件名</code><br>卸载这些软件包:<code>rpm -e yum-plugin-fastestmirror-1.1.31-34.el7.noarch --nodeps</code></p>
<h3 id="unzip"><a href="#unzip" class="headerlink" title="unzip"></a>unzip</h3><p>linux下解压zip文件使用命令<br>    用法:<code>zip [参数] [打包后的文件名] [打包的目录路径]</code><br>路径可以是相对路径，也可以是绝对路径<br>如： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#将file.conf.zip解压到&#x2F;data&#x2F;bak 目录下</span><br><span class="line">unzip file.conf.zip -d &#x2F;data&#x2F;bak</span><br></pre></td></tr></table></figure>

<h3 id="chmod、chown、chgrp文件权限操作"><a href="#chmod、chown、chgrp文件权限操作" class="headerlink" title="chmod、chown、chgrp文件权限操作"></a>chmod、chown、chgrp文件权限操作</h3><p>&emsp;&emsp;Linux系统中文件或目录的访问权限分为只读，只写和可执行三种。文件被创建时，文件所有者自动拥有对该文件的读、写和可执行权限，以便于对文件的阅读和修改。用户也可根据需要把访问权限设置为需要的任何组合。<br>&emsp;&emsp;有三种不同类型的用户可对文件或目录进行访问：文件所有者（属主），同组用户、其他用户。所有者一般是文件的创建者。所有者可以允许同组用户有权访问文件，还可以将文件的访问权限赋予系统中的其他用户。<br>&emsp;&emsp;每一个文件或目录的访问权限都有三组，每组用三位表示，分别为文件属主的读、写和执行权限；与拥有者同组的用户的读、写和执行权限；系统中其他用户的读、写和执行权限。当用ls -l命令显示文件或目录的详细信息时，最左边的一列为文件的访问权限。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r--. 1 root root      1207 5月  19 18:12 application.yml</span><br><span class="line">drwxr-xr-x. 3 root root        18 4月  29 01:05 hanlp</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;其中：r代表只读，w代表写，x代表可执行<br>&emsp;&emsp;第一位为表示文件类型，如果这个字母是一个减号”-“,则说明该文件是一个普通文件.字母”d”表示该文件是一个目录,字母”d”,是dirtectory(目录)的缩写。（其他详细信息请参考：）。第一字段的后面9个字母表示文件的权限：前三个表示文件属主的权限,中间三个表示组用户权限,最后三个表示其他用户权限.</p>
<h4 id="1-chmod-重新设定不同的访问权限"><a href="#1-chmod-重新设定不同的访问权限" class="headerlink" title="1.chmod 重新设定不同的访问权限"></a>1.chmod 重新设定不同的访问权限</h4><p>1.1 权限基本介绍<br>&emsp;&emsp;修改文件夹及子文件夹权限命令：<code>chmod -R 777 /opt/parse</code><br>&emsp;&emsp;其中：-R：表示递归；<br>&emsp;&emsp;777：最高位7是设置文件所有者访问权限，第二位是设置群组访问权限，最低位是设置其他人访问权限。其中每一位的权限用数字来表示。具体有这些权限：<br>&emsp;&emsp;r(Read，读取，权限值为4)：对文件而言，具有读取文件内容的权限；对目录来说，具有浏览目 录的权限。<br>&emsp;&emsp;w(Write,写入，权限值为2)：对文件而言，具有新增、修改文件内容的权限；对目录来说，具有删除、移动目录内文件的权限。<br>&emsp;&emsp;x(eXecute，执行，权限值为1)：对文件而言，具有执行文件的权限；对目录了来说该用户具有进入目录的权限。<br>&emsp;&emsp;eg：当数字为7时，7用“rwx”表示：{4(r)+2(w)+1(x)=7}<br>&emsp;&emsp;又如果数值为6，则用“rw-”表示：{4(r)+2(w)+0(x)=6}，”-”表示不具备权限，这里表示不具备“执行”权限。<br>&emsp;&emsp;当其他用户的访问权限为 “r–”，则数值为4+0+0=4<br>&emsp;&emsp;简化理解：将rwx看成二进制数，如果有则用1表示，没有则有0表示，那么rwx则可以表示成为：111，而二进制的111就是7。<br>&emsp;&emsp;故：如果文件所有者有“读”、“写”、“执行”权限，群组用户有“读”权限，其他用户有“读”权限，则对应的字母表示为”rwx r–r–”，对应的数字为744.一般都是最高位表示文件所有者权限值，第二位表示群组用户权限，最低位表示其他用户权限。<br>1.2 chmod包含字母和操作符表达式的文字设定法<br>&emsp;&emsp;语法结构：<code>chmod ［who］ ［+|–|=］ ［mode］ 文件名</code></p>
<p>操作对象who可是下述字母中的任一个或者它们的组合：</p>
<blockquote>
<p>u 表示“用户（user）”，即文件或目录的所有者。<br>g 表示“同组（group）用户”，即与文件属主有相同组ID的所有用户。<br>o 表示“其他（others）用户”。<br>a 表示“所有（all）用户”。它是系统默认值。</p>
</blockquote>
<p>操作符号可以是：</p>
<blockquote>
<p>+ 添加某个权限。<br>– 取消某个权限。<br>= 赋予给定权限并取消其他所有权限（如果有的话）。<br>设置mode所表示的权限可用下述字母的任意组合：<br>r 可读。<br>w 可写。<br>x 可执行。<br>X 只有目标文件对某些用户是可执行的或该目标文件是目录时才追加x 属性。<br>s 在文件执行时把进程的属主或组ID置为该文件的文件属主。方式“u＋s”设置文件的用户ID位，“g＋s”设置组ID位。<br>t 保存程序的文本到交换设备上。<br>u 与文件属主拥有一样的权限。<br>g 与和文件属主同组的用户拥有一样的权限。<br>o 与其他用户拥有一样的权限。<br>-c : 若该档案权限确实已经更改，才显示其更改动作<br>-f : 若该档案权限无法被更改也不要显示错误讯息<br>-v : 显示权限变更的详细资料<br>-R : 对目前目录下的所有档案与子目录进行相同的权限变更(即以递回的方式逐个变更)<br>–help : 显示辅助说明<br>–version : 显示版本</p>
</blockquote>
<p>文件名：</p>
<blockquote>
<p>以空格分开的要改变权限的文件列表，支持通配符。在一个命令行中可给出多个权限方式，其间用逗号隔开。例如：chmod g+r，o+r example使同组和其他用户对文件example 有读权限。</p>
</blockquote>
<p>1.3 包含数字的数字设定法<br>&emsp;&emsp;数字表示的属性的含义：0表示没有权限，1表示可执行权限，2表示可写权限，4表示可读权限，然后将其相加。所以数字属性的格式应为3个从0到7的八进制数，其顺序是（u）（g）（o）。<br>&emsp;&emsp;例如:如果想让某个文件的属主有“读/写”二种权限，需要把4（可读）+2（可写）＝6（读/写）。</p>
<p>&emsp;&emsp;数字设定法的一般形式为：<code>chmod ［mode］ 文件名</code><br>例1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ chmod 644 mm.txt</span><br><span class="line">$ ls –l</span><br><span class="line">-rw-r--r-- 1 inin users 1155 Nov 5 11:22 mm.txt</span><br></pre></td></tr></table></figure>
<blockquote>
<p>即设定文件mm.txt的属性为：<br>文件属主（u）inin 拥有读、写权限<br>与文件属主同组人用户（g）拥有读权限<br>其他人（o） 拥有读权限</p>
</blockquote>
<p>例2：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ chmod 750 wch.txt</span><br><span class="line">$ ls –l</span><br><span class="line">-rwxr-x--- 1 inin users 44137 Nov 12 9:22 wchtxt</span><br></pre></td></tr></table></figure>
<blockquote>
<p>即设定wchtxt这个文件的属性为：<br>文件主本人（u）inin 可读/可写/可执行权<br>与文件主同组人（g） 可读/可执行权<br>其他人（o） 没有任何权限</p>
</blockquote>
<h4 id="2-chgrp-更改某个文件或目录所属的组"><a href="#2-chgrp-更改某个文件或目录所属的组" class="headerlink" title="2.chgrp 更改某个文件或目录所属的组"></a>2.chgrp 更改某个文件或目录所属的组</h4><p>语法：<code>chgrp ［选项］ group filename</code><br>参数：</p>
<blockquote>
<p>-c或–changes 效果类似”-v”参数，但仅回报更改的部分。<br>-f或–quiet或–silent 　不显示错误信息。<br>-h或–no-dereference 　只对符号连接的文件作修改，而不更动其他任何相关文件。<br>-R或–recursive 　递归处理，将指定目录下的所有文件及子目录一并处理。<br>-v或–verbose 　显示指令执行过程。<br>–help 　在线帮助。<br>–reference=&lt;参考文件或目录&gt; 　把指定文件或目录的所属群组全部设成和参考文件或目录的所属群组相同。<br>–version 　显示版本信息。</p>
</blockquote>
<p>&emsp;&emsp;该命令改变指定指定文件所属的用户组。其中group可以是用户组ID，也可以是/etc/group文件中用户组的组名。文件名是以空格分开的要改变属组的文件列表，支持通配符。如果用户不是该文件的属主或超级用户，则不能改变该文件的组。</p>
<p>&emsp;&emsp;该命令的各选项含义为：–R 递归式地改变指定目录及其下的所有子目录和文件的属组。</p>
<h4 id="3-chown-更改某个文件或目录的所有者"><a href="#3-chown-更改某个文件或目录的所有者" class="headerlink" title="3.chown 更改某个文件或目录的所有者"></a>3.chown 更改某个文件或目录的所有者</h4><p>&emsp;&emsp;功能：更改某个文件或目录的属主和属组。这个命令也很常用。例如root用户把自己的一个文件拷贝给用户yusi，为了让用户yusi能够存取这个文件，root用户应该把这个文件的属主设为yusi，否则，用户yusi无法存取这个文件。<br>语法：<code>chown ［选项］ 用户或组 文件</code><br>说明：chown将指定文件的拥有者改为指定的用户或组。用户可以是用户名或用户ID。组可以是组名或组ID。文件是以空格分开的要改变权限的文件列表，支持通配符。<br>参数说明：</p>
<blockquote>
<p>user : 新的档案拥有者的使用者 ID<br>group : 新的档案拥有者的使用者群体(group)<br>-c : 若该档案拥有者确实已经更改，才显示其更改动作<br>-f : 若该档案拥有者无法被更改也不要显示错误讯息<br>-h : 只对于连结(link)进行变更，而非该 link 真正指向的档案<br>-v : 显示拥有者变更的详细资料<br>-R : 对目前目录下的所有档案与子目录进行相同的拥有者变更(即以递回的方式逐个变更)<br>–help : 显示辅助说明<br>–version : 显示版本</p>
</blockquote>
<p>例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chown yusi yusi123.com(把文件yusi123.com的所有者改为yusi)</span><br><span class="line">chown - R yusi.users &#x2F;demo(把目录&#x2F;demo及其下的所有文件和子目录的属主改成yusi，属组改成users)</span><br><span class="line">chown qq &#x2F;home&#x2F;qq  (把home目录下的qq目录的拥有者改为qq用户)</span><br><span class="line">chown -R qq &#x2F;home&#x2F;qq  (把home目录下的qq目录下的所有子文件的拥有者改为qq用户)</span><br></pre></td></tr></table></figure>
<p>参考链接：<a href="https://www.cnblogs.com/Berryxiong/p/6193866.html" target="_blank" rel="noopener">Linux命令:修改文件权限命令chmod、chgrp、chown详解</a></p>
<h3 id="scp文件传输"><a href="#scp文件传输" class="headerlink" title="scp文件传输"></a>scp文件传输</h3><p> 上传文件<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#上传文件</span><br><span class="line">scp test.txt root@107.172.27.254:&#x2F;home</span><br><span class="line">#上传目录</span><br><span class="line">scp -r test root@107.172.27.254:&#x2F;home</span><br><span class="line">#从一个服务器上传到另一个服务器</span><br><span class="line">scp root@192.168.1.104:&#x2F;opt&#x2F;xx.txt root@192.168.1.105:&#x2F;opt&#x2F;html&#x2F;webs&#x2F;</span><br></pre></td></tr></table></figure><br> 下载文件</p>
<pre><code>#下载文件
scp root@107.172.27.254:/home/test.txt
#下载目录
scp -r root@107.172.27.254:/home/test
#下载多个文件
scp root@192.168.1.104:/opt/html/webs/\{index.css,json.js\}</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/14/Java%E5%AF%B9%E8%B1%A1%E4%B8%8D%E5%86%8D%E4%BD%BF%E7%94%A8%E6%97%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YouQiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秦音">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/14/Java%E5%AF%B9%E8%B1%A1%E4%B8%8D%E5%86%8D%E4%BD%BF%E7%94%A8%E6%97%B6/" itemprop="url">Java对象不再使用时，为什么要赋值为null</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-14T14:23:00+08:00">
                2020-05-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp; 先来看看一段非常简单的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] placeHolder = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        System.out.println(placeHolder.length / <span class="number">1024</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.gc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 在if中实例化了一个数组placeHolder，然后在if的作用域外通过System.gc();手动触发了GC，其用意是回收placeHolder，因为placeHolder已经无法访问到了。来看看输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">65536</span></span><br><span class="line">[GC <span class="number">68239</span>K-&gt;<span class="number">65952</span>K(<span class="number">125952</span>K), <span class="number">0.0014820</span> secs]</span><br><span class="line">[Full GC <span class="number">65952</span>K-&gt;<span class="number">65881</span>K(<span class="number">125952</span>K), <span class="number">0.0093860</span> secs]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; Full GC 65952K-&gt;65881K(125952K)代表的意思是：本次GC后，内存占用从65952K降到了65881K。意思其实是说GC没有将placeHolder回收掉，是不是不可思议？</p>
<p>&emsp;&emsp; 下面来看看遵循“不使用的对象应手动赋值为null“的情况：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] placeHolder = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        System.out.println(placeHolder.length / <span class="number">1024</span>);</span><br><span class="line">        placeHolder = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    System.gc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 其输出为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">65536</span></span><br><span class="line">[GC <span class="number">68239</span>K-&gt;<span class="number">65952</span>K(<span class="number">125952</span>K), <span class="number">0.0014910</span> secs]</span><br><span class="line">[Full GC <span class="number">65952</span>K-&gt;<span class="number">345</span>K(<span class="number">125952</span>K), <span class="number">0.0099610</span> secs]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 这次GC后内存占用下降到了345K，即placeHolder被成功回收了！对比两段代码，仅仅将placeHolder赋值为null就解决了GC的问题，真应该感谢“不使用的对象应手动赋值为null“。</p>
<p>&emsp;&emsp; 等等，为什么例子里placeHolder不赋值为null，GC就“发现不了”placeHolder该回收呢？这才是问题的关键所在。</p>
<h3 id="典型的运行时栈"><a href="#典型的运行时栈" class="headerlink" title="典型的运行时栈"></a>典型的运行时栈</h3><p>&emsp;&emsp; 方法在执行的时候，方法里的变量（局部变量）都是分配在栈上的；当然，对于Java来说，new出来的对象是在堆中，但栈中也会有这个对象的指针，和int一样。<br>&emsp;&emsp; 比如对于下面这段代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> c = a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 其运行时栈的状态可以理解成：</p>
<table>
<thead>
<tr>
<th>索引</th>
<th>变量</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>a</td>
</tr>
<tr>
<td>2</td>
<td>b</td>
</tr>
<tr>
<td>3</td>
<td>c</td>
</tr>
</tbody></table>
<p>&emsp;&emsp; “索引”表示变量在栈中的序号，根据方法内代码执行的先后顺序，变量被按顺序放在栈中。</p>
<p>再比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    if (true) &#123;</span><br><span class="line">        int a &#x3D; 1;</span><br><span class="line">        int b &#x3D; 2;</span><br><span class="line">        int c &#x3D; a + b;</span><br><span class="line">    &#125;</span><br><span class="line">    int d &#x3D; 4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 这时运行时栈就是：</p>
<table>
<thead>
<tr>
<th align="left">索引</th>
<th align="left">变量</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">a</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">b</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">c</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">d</td>
</tr>
</tbody></table>
<p>&emsp;&emsp; 容易理解吧？其实仔细想想上面这个例子的运行时栈是有优化空间的。</p>
<h3 id="Java的栈优化"><a href="#Java的栈优化" class="headerlink" title="Java的栈优化"></a>Java的栈优化</h3><p>&emsp;&emsp; 上面的例子，main()方法运行时占用了4个栈索引空间，但实际上不需要占用这么多。当if执行完后，变量a、b和c都不可能再访问到了，所以它们占用的1～3的栈索引是可以“回收”掉的，比如像这样：</p>
<table>
<thead>
<tr>
<th align="left">索引</th>
<th align="left">变量</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">a</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">b</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">c</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">d</td>
</tr>
</tbody></table>
<p>&emsp;&emsp; 变量d重用了变量a的栈索引，这样就节约了内存空间。</p>
<blockquote>
<p>注意：上面的“运行时栈”和“索引”是为方便引入而故意发明的词，实际上在JVM中，它们的名字分别叫做“局部变量表”和“Slot”。而且局部变量表在编译时即已确定，不需要等到“运行时”。</p>
</blockquote>
<h3 id="GC简单介绍"><a href="#GC简单介绍" class="headerlink" title="GC简单介绍"></a>GC简单介绍</h3><p>&emsp;&emsp; 如何确定对象可以被回收。另一种表达是，如何确定对象是存活的。在Java的世界中，对象与对象之间是存在关联的，我们可以从一个对象访问到另一个对象。如图所示:<br><img src="/images/java/GC.jpg" alt=""><br>&emsp;&emsp; 而这些对象与对象之间构成的引用关系，就像是一张大大的图；更清楚一点，是众多的树。如果找到了所有的树根，那么从树根走下去就能找到所有存活的对象，那么那些没有找到的对象，就是已经死亡的了！这样GC就可以把那些对象回收掉了。</p>
<p>&emsp;&emsp; 现在的问题是，怎么找到树根呢？JVM早有规定，其中一个就是：栈中引用的对象。也就是说，只要堆中的这个对象，在栈中还存在引用，就会被认定是存活的。</p>
<p>&emsp;&emsp; <strong>上面介绍的确定对象可以被回收的算法，其名字是“可达性分析算法”。</strong></p>
<h3 id="JVM的“bug”"><a href="#JVM的“bug”" class="headerlink" title="JVM的“bug”"></a>JVM的“bug”</h3><p>&emsp;&emsp; 我们再来回头看看最开始的例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] placeHolder = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        System.out.println(placeHolder.length / <span class="number">1024</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.gc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 看看其运行时栈：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LocalVariableTable:</span><br><span class="line">Start  Length  Slot  Name   Signature</span><br><span class="line">    <span class="number">0</span>      <span class="number">21</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">    <span class="number">5</span>      <span class="number">12</span>     <span class="number">1</span> placeHolder   [B</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 栈中第一个索引是方法传入参数args，其类型为String[]；第二个索引是placeHolder，其类型为byte[]。</p>
<p>&emsp;&emsp; 联系前面的内容，我们推断placeHolder没有被回收的原因：<strong>System.gc();触发GC时，main()方法的运行时栈中，还存在有对args和placeHolder的引用，GC判断这两个对象都是存活的，不进行回收。</strong>也就是说，代码在离开if后，虽然已经离开了placeHolder的作用域，但在此之后，没有任何对运行时栈的读写，placeHolder所在的索引还没有被其他变量重用，所以GC判断其为存活。</p>
<p>&emsp;&emsp; 为了验证这一推断，现在在System.gc();之前再声明一个变量，按照之前提到的“Java的栈优化”，这个变量会重用placeHolder的索引。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">byte</span>[] placeHolder = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span> * <span class="number">1024</span> * <span class="number">1024</span>];</span><br><span class="line">        System.out.println(placeHolder.length / <span class="number">1024</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> replacer = <span class="number">1</span>;</span><br><span class="line">    System.gc();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 看看其运行时栈：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LocalVariableTable:</span><br><span class="line">Start  Length  Slot  Name   Signature</span><br><span class="line">    <span class="number">0</span>      <span class="number">23</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">    <span class="number">5</span>      <span class="number">12</span>     <span class="number">1</span> placeHolder   [B</span><br><span class="line">   <span class="number">19</span>       <span class="number">4</span>     <span class="number">1</span> replacer   I</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 不出所料，replacer重用了placeHolder的索引。来看看GC情况：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">65536</span></span><br><span class="line">[GC <span class="number">68239</span>K-&gt;<span class="number">65984</span>K(<span class="number">125952</span>K), <span class="number">0.0011620</span> secs]</span><br><span class="line">[Full GC <span class="number">65984</span>K-&gt;<span class="number">345</span>K(<span class="number">125952</span>K), <span class="number">0.0095220</span> secs]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; placeHolder被成功回收了！我们的推断也被验证了。</p>
<p>&emsp;&emsp; 再从运行时栈来看，加上int replacer = 1;和将placeHolder赋值为null起到了同样的作用：断开堆中placeHolder和栈的联系，让GC判断placeHolder已经死亡。</p>
<p>&emsp;&emsp; “不使用的对象应手动赋值为null“的一切根源都是来自于JVM的一个“bug”：代码离开变量作用域时，并不会自动切断其与堆的联系。导致JVM该变量任有对象在引用，不是垃圾对象。但实际上该对象无法再被其他对象引用，就跟垃圾一样。</p>
<p>参考链接：<a href="https://mp.weixin.qq.com/s/Lebc-uJTLgcmEqrBdMb6dg" target="_blank" rel="noopener" title="Java对象不再使用时，为什么要赋值为null？">Java对象不再使用时，为什么要赋值为null？</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/13/Shell%E8%84%9A%E6%9C%AC%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YouQiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秦音">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/13/Shell%E8%84%9A%E6%9C%AC%E5%91%BD%E4%BB%A4/" itemprop="url">shell脚本命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-13T15:35:00+08:00">
                2020-05-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/shell/" itemprop="url" rel="index">
                    <span itemprop="name">shell</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>让.sh文件变为可执行的脚本文件命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 xxx.sh</span><br></pre></td></tr></table></figure>
<h3 id="1-for循环"><a href="#1-for循环" class="headerlink" title="1.for循环"></a>1.for循环</h3><p>for循环一般格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for 变量名 in 列表</span><br><span class="line">do</span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    ...</span><br><span class="line">    commandN</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 当变量值在列表里，for循环即执行一次所有命令，使用变量名获取列表中的当前取值。命令可为任何有效的shell命令和语句。in列表可以包含替换、字符串和文件名。in列表是可选的，如果不用它，for循环使用命令行的位置参数。</p>
<p>例如，顺序输出当前列表中的数字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for loop in 1 2 3 4 5</span><br><span class="line">do</span><br><span class="line">    echo &quot;The value is: $loop&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The value is: 1</span><br><span class="line">The value is: 2</span><br><span class="line">The value is: 3</span><br><span class="line">The value is: 4</span><br><span class="line">The value is: 5</span><br></pre></td></tr></table></figure>
<p>顺序输出字符串中的字符：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for str in &#39;This is a string&#39;</span><br><span class="line">do</span><br><span class="line">    echo $str</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is a string</span><br></pre></td></tr></table></figure>
<h3 id="2-获取当前时间，并进行格式转换的方法"><a href="#2-获取当前时间，并进行格式转换的方法" class="headerlink" title="2.获取当前时间，并进行格式转换的方法"></a>2.获取当前时间，并进行格式转换的方法</h3><p>1）原格式输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">time1&#x3D;$(date)</span><br><span class="line">echo $time1</span><br></pre></td></tr></table></figure>
<p>输出：<code>2018年 09月 30日 星期日 15:55:15 CST</code><br>2）时间串输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 #!bin&#x2F;bash</span><br><span class="line">2 time2&#x3D;$(date &quot;+%Y%m%d%H%M%S&quot;)</span><br><span class="line">3 echo $time2</span><br></pre></td></tr></table></figure>
<p>输出：<code>20180930155515</code><br> 3）格式转换输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!bin&#x2F;bash</span><br><span class="line">time3&#x3D;$(date &quot;+%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line">echo $time3</span><br></pre></td></tr></table></figure>
<p>输出：<code>2018-09-30 15:55:15</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!bin&#x2F;bash</span><br><span class="line">time4&#x3D;$(date &quot;+%Y.%m.%d&quot;)</span><br><span class="line">echo $time4</span><br></pre></td></tr></table></figure>
<p>输出：<code>2018.09.30</code></p>
<blockquote>
<p>注意：<br>① <code>$(date &quot;&quot;)</code>类似的格式转换时，date后面要留有空格<br>②<code>time4=$(date &quot;+%Y.%m.%d&quot;)</code>time4变量赋值前后不能有空格</p>
</blockquote>
<p>相关变量解释：</p>
<blockquote>
<p>Y显示4位年份，如：2018；y显示2位年份，如：18。<br>m表示月份；M表示分钟。<br>d表示天；D则表示当前日期，如：1/18/18(也就是2018.1.18)。<br>H表示小时，而h显示月份。<br>s显示当前秒钟，单位为毫秒；S显示当前秒钟，单位为秒。</p>
</blockquote>
<h3 id="3-获取指定文件夹大小"><a href="#3-获取指定文件夹大小" class="headerlink" title="3.获取指定文件夹大小"></a>3.获取指定文件夹大小</h3><p>3.1 获取指定文件夹大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#&#x2F;!bin&#x2F;base</span><br><span class="line">#设置文件夹地址（精确到文件夹名  如:需要获得file_name  文件夹的大小）</span><br><span class="line">file_url&#x3D;&quot;&#x2F;home&#x2F;file_name&quot;&quot;</span><br><span class="line">#获取[ 文件夹 ]大小(单位kb)</span><br><span class="line">file_kb&#x3D;$((&#96;du --max-depth&#x3D;1 $&#123;file_url&#125;|awk &#39;&#123;print $1&#125;&#39;&#96;))</span><br><span class="line">#打印输出文件夹大小</span><br><span class="line">echo &quot;file_size:$file_kb&quot;</span><br></pre></td></tr></table></figure>
<p>3.2 获取指定文件大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#&#x2F;!bin&#x2F;base</span><br><span class="line">#获取文件位置</span><br><span class="line">file_url&#x3D;&quot;&#x2F;home&#x2F;file_name&#x2F;a.log&quot;</span><br><span class="line">#获取文件大小(单位kb)</span><br><span class="line">file_kb&#x3D;$((&#96;ls -l $&#123;file_url&#125; | awk &#39;&#123;print $5&#125;&#39;&#96;))</span><br><span class="line">echo &quot;file_size：$file_kb&quot;</span><br></pre></td></tr></table></figure>

<h3 id="4-脚本变量-0-1-2-含义"><a href="#4-脚本变量-0-1-2-含义" class="headerlink" title="4.脚本变量$[#,@,0,1,2,*,$,?]含义"></a>4.脚本变量$[#,@,0,1,2,*,$,?]含义</h3><blockquote>
<p>$# 是传给脚本的参数个数<br>$0 是脚本本身的名字<br>$1 是传递给该shell脚本的第一个参数<br>$2 是传递给该shell脚本的第二个参数<br>$@ 是传给脚本的所有参数的列表<br>$* 是以一个单字符串显示所有向脚本传递的参数，与位置变量不同，参数可超过9个<br>$$ 是脚本运行的当前进程ID号<br>$? 是显示最后命令的退出状态，0表示没有错误，其他表示有错误</p>
</blockquote>
<p>$@, $*两者的区别：<br>&emsp;&emsp; 相同点：都是引用所有参数<br>&emsp;&emsp; 不同点：$* 和 $@ 都表示传递给函数或脚本的所有参数，不被双引号(“ “)包含时，都以”$1” “$2” … “$n” 的形式输出所有参数。但是当它们被双引号(“ “)包含时，”$*“ 会将所有的参数作为一个整体，以”$1 $2 … $n”的形式输出所有参数；”$@” 会将各个参数分开，以”$1” “$2” … “$n” 的形式输出所有参数。</p>
<p><a href="https://blog.csdn.net/zhejiang9/article/details/7887569" target="_blank" rel="noopener" title="shell中$*与$@的区别">shell中$*与$@的区别</a></p>
<h3 id="5-if-ne-1-then命令"><a href="#5-if-ne-1-then命令" class="headerlink" title="5.if [ $# -ne 1 ];then命令"></a>5.if [ $# -ne 1 ];then命令</h3><p>if [ $# -ne 1 ];then 是什么意思?</p>
<blockquote>
<p>$# 是启动脚本时携带的参数个数<br>-ne 是不等于,这个语句的意思是“如果shell的启动参数不等于1个”<br>$# 表示提供到shell脚本或者函数的参数总数；<br>$1 表示第一个参数。<br>-ne 表示 不等于</p>
</blockquote>
<p>另外：<br>整数比较</p>
<blockquote>
<p>-eq     等于,如:if [“$a” -eq “$b” ]<br>-ne     不等于,如:if [“$a” -ne “$b” ]<br>-gt     大于,如:if [“$a” -gt “$b” ]<br>-ge    大于等于,如:if [“$a” -ge “$b” ]<br>-lt      小于,如:if [“$a” -lt “$b” ]<br>-le      小于等于,如:if [“$a” -le “$b” ]<br>&lt;  小于(需要双括号),如:((“$a” &lt; “$b”))<br>&lt;=  小于等于(需要双括号),如:((“$a” &lt;= “$b”))<br> 大于(需要双括号),如:((“$a” &gt; “$b”))<br>=  大于等于(需要双括号),如:((“$a” &gt;= “$b”))</p>
</blockquote>
<p>另外：$?是shell变量,表示”最后一次执行命令”的退出状态.0为成功,非0为失败.</p>
<p>参考链接：<a href="https://www.jb51.net/article/36739.htm" target="_blank" rel="noopener">Linux 脚本编写基础知识</a></p>
<h3 id="6-shell脚本实现scp文件传输"><a href="#6-shell脚本实现scp文件传输" class="headerlink" title="6.shell脚本实现scp文件传输"></a>6.shell脚本实现scp文件传输</h3><p>&emsp;&emsp; scp是一个基于ssh的Linux环境下传输文件的好工具，但是使用shell脚本调用scp时会面临一个问题，即scp强制要求通过交互方式输入密码，而不像mysql等拥有-u -p选项。下面有两种方法帮助shell脚本跨过输入密码这个障碍。</p>
<h4 id="6-1-建立机器间完全信任关系（这种方式没有操作过，不确定可靠性）"><a href="#6-1-建立机器间完全信任关系（这种方式没有操作过，不确定可靠性）" class="headerlink" title="6.1 建立机器间完全信任关系（这种方式没有操作过，不确定可靠性）"></a>6.1 建立机器间完全信任关系（这种方式没有操作过，不确定可靠性）</h4><p>假设需要从机器A传输文件至机器B<br>1）在机器A上运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 上述命令会在~/.ssh/目录生成私钥证书id_rsa和公钥证书id_rsa.pub；<br>2）将公钥证书id_rsa.pub复制到机器B的用户根目录的.ssh子目录中，再将文件内容append到文件authorized_keys中。<br>&emsp;&emsp; 其实只要用一条单行命令就可以完成步骤2，它被commandlinefu.com的用户投票选为十大最酷的Linux单行命令之一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id  [-i [identity_file]]  [user@]machine</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; identity_file是公钥证书的路径，默认情况下是~/.ssh/id_rsa.pub.</p>
<p>&emsp;&emsp; 如果要建立双方向的完全信任关系，还要从机器B到机器A再重复一遍上面的操作。<br>不过这样的方法并不完美，一是运维成本太高，二是机器间的安全屏障完全消失，安全代价太大，所以强烈推荐第二种方法。</p>
<h4 id="6-2-expect脚本"><a href="#6-2-expect脚本" class="headerlink" title="6.2 expect脚本"></a>6.2 expect脚本</h4><p>&emsp;&emsp; expect脚本是一种建立在tcl基础上的脚本语言，曝光率不高，却堪称shell脚本的好基友。expect脚本为交互而生，被设计为专门针对交互式程序的工具，常与对telnet、ftp、fsck、rlogin、tip、scp等配合使用。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;bin&#x2F;sh</span><br><span class="line">&#x2F;usr&#x2F;expect&#x2F;bin&#x2F;expect -c &quot;</span><br><span class="line">	spawn scp -r aiidc-parse-rundata-1.0-SNAPSHOT.jar root@172.16.16.184:&#x2F;root</span><br><span class="line">	expect &#123;</span><br><span class="line">		\&quot;yes&#x2F;no\&quot; &#123;send \&quot;yes\r\&quot;; exp_continue;&#125;</span><br><span class="line">		\&quot;*assword\&quot; &#123;set timeout 200; send \&quot;aiidc@2019\r\&quot;; exp_continue;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	expect eof</span><br><span class="line">&quot;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 这段脚本的含义是监听scp命令，如果输入包含*assword，则输入密码“passwd”；如果输入包含yes/no，输入yes并继续进行交互（exp_continue)。<br>&emsp;&emsp; 注：两个用户第一次scp连接时会提示“… Are you sure you want to continue connecting (yes/no)? …”，所以要考虑yes/no的情况。</p>
<h4 id="6-3-使用sshpass免密操作"><a href="#6-3-使用sshpass免密操作" class="headerlink" title="6.3 使用sshpass免密操作"></a>6.3 使用sshpass免密操作</h4><p>使用sshpass命令可以在脚本中提前输入密码便于直接运行命令：<br>eg:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sshpass -p aiidc@2019 scp -r aiidc-parse-rundata-1.0-SNAPSHOT.jar root@172.16.16.184:&#x2F;root</span><br><span class="line">sshpass -p aiidc@2019 ssh root@172.16.16.184 &#39;cd &#x2F;opt&#x2F;parse-etl&#x2F;kafka&#x2F;&#39;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 注意:在使用sshpass操作ssh命令时，通过ssh连接目标服务器后，如果有多个命令要执行，可将多条命令书写在一条命令上通过&amp;&amp;间隔，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshpass -p aiidc@2019 ssh root@172.16.16.184 &#39;cd &#x2F;opt&#x2F;parse-etl&#x2F;kafka&#x2F; &amp;&amp; rm -rf aiidc-parse-rundata-1.0-SNAPSHOT.jar &amp;&amp; ls &amp;&amp; mv &#x2F;root&#x2F;aiidc-parse-rundata-1.0-SNAPSHOT.jar .&#x2F;&#39;</span><br></pre></td></tr></table></figure>
<p>该命令的意思连接184服务器后，进入指定目录，先删除jar，然后将新jar移动到目标位置</p>
<p>ssh 用户名@目的主机地址 ‘要执行的命令或者脚本’<br>注意：</p>
<blockquote>
<p>在调用脚本时，必须写全该脚本所在的全路径。<br>要执行的命令用单引号’  ’扩起来，引号扩起来的命令要和前面的内容写在一行，不能换行。</p>
</blockquote>
<h3 id="centos-7-jar包发布服务并开机启动"><a href="#centos-7-jar包发布服务并开机启动" class="headerlink" title="centos 7 jar包发布服务并开机启动"></a>centos 7 jar包发布服务并开机启动</h3><h4 id="7-1-jar启动脚本start-sh"><a href="#7-1-jar启动脚本start-sh" class="headerlink" title="7.1 jar启动脚本start.sh"></a>7.1 jar启动脚本start.sh</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">#先检查是否已启动</span><br><span class="line">count&#x3D;&#96;ps -ef | grep &#39;&#x2F;opt&#x2F;parse&#x2F;api&#x2F;dimension&#x2F;aiidc-justice-dimension-1.0-SNAPSHOT.jar&#39; | grep -v &quot;grep&quot; | wc -l&#96;</span><br><span class="line">#echo $count</span><br><span class="line">if [ $count -gt 0 ]</span><br><span class="line">then </span><br><span class="line">  echo &quot;is running...&quot;</span><br><span class="line">else</span><br><span class="line">  #下面的cd不能少</span><br><span class="line">  cd &#x2F;opt&#x2F;api&#x2F;zgjdev&#x2F;</span><br><span class="line">  nohup java -jar -Dhanlp_properties_path&#x3D;&#x2F;opt&#x2F;parse&#x2F;api&#x2F;dimension&#x2F;config&#x2F;hanlp.properties -Dspringfox.documentation.swagger.v2.host&#x3D;172.16.16.153:80 -Xmx1024m &#x2F;opt&#x2F;parse&#x2F;api&#x2F;dimension&#x2F;aiidc-justice-dimension-1.0-SNAPSHOT.jar &gt;&#x2F;opt&#x2F;parse&#x2F;api&#x2F;dimension&#x2F;log 2&gt;&#x2F;dev&#x2F;null &amp; echo $! &gt; &#x2F;opt&#x2F;parse&#x2F;api&#x2F;dimension&#x2F;pid</span><br><span class="line">  echo &quot;started&quot;</span><br><span class="line">fi</span><br><span class="line">cat &#x2F;opt&#x2F;parse&#x2F;api&#x2F;dimension&#x2F;pid</span><br></pre></td></tr></table></figure>
<p>启动的时候会生成pid文件（这个在制作启动服务地方会用到）<br>注意：start.sh里面路径都要写成绝对路径</p>
<h4 id="7-2-制作启动服务"><a href="#7-2-制作启动服务" class="headerlink" title="7.2 制作启动服务"></a>7.2 制作启动服务</h4><p>服务名称：xxx.service<br>以解析应用为例：parse.service</p>
<p>服务脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description&#x3D;parse</span><br><span class="line">After&#x3D;syslog.target network.target remote-fs.target nss-lookup.target</span><br><span class="line">	</span><br><span class="line">[Service]</span><br><span class="line">User&#x3D;root</span><br><span class="line">Type&#x3D;simple</span><br><span class="line">PIDFile&#x3D;&#x2F;opt&#x2F;parse&#x2F;api&#x2F;dimension&#x2F;pid</span><br><span class="line">ExecStart&#x3D;&#x2F;opt&#x2F;parse&#x2F;api&#x2F;dimension&#x2F;start.sh</span><br><span class="line">ExecStop&#x3D;&#x2F;bin&#x2F;kill -15 $MAINPID</span><br><span class="line">	</span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
<p>需要修改的地方<br>Description 修改为自己的名字或者描述<br>PIDFile 修改为自己服务启动后保存的pid文件路径<br>ExecStart 修改为自己的启动脚本路径</p>
<h4 id="7-3-通过服务启动"><a href="#7-3-通过服务启动" class="headerlink" title="7.3 通过服务启动"></a>7.3 通过服务启动</h4><p>将做好的服务拷贝到/etc/systemd/system/路径下</p>
<p>执行<br><code>systemctl daemon-reload</code><br>加入开机启动<br><code>systemctl enable data-application.service</code><br><img src="/images/linux/%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8.png" alt=""><br>看到这个表示加入开机自启成功</p>
<p>另：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#通过服务启动程序</span><br><span class="line">systemctl start data-application.service</span><br><span class="line">#通过服务停止程序</span><br><span class="line">systemctl stop data-application.service</span><br></pre></td></tr></table></figure>
<p>参考链接：<a href="https://blog.csdn.net/qq_41101788/article/details/98071456" target="_blank" rel="noopener">Linux centos7下jar包发布成服务并开机自启</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/29/ubuntu%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YouQiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秦音">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/29/ubuntu%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" itemprop="url">ubuntu虚拟机忘记密码解决方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-29T14:00:00+08:00">
                2020-04-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ubuntu/" itemprop="url" rel="index">
                    <span itemprop="name">ubuntu</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>当在ubuntu虚拟机中想切换root或其他用户时，忘记了密码，通过下面的步骤重置密码：<br>1、重启ubuntu系统，开机时长按shift按键进入GRUB菜单，选择第二个高级选项。如下图：<br><img src="/images/virtual/ubuntn/password_1.png" alt=""><br>2、在高级选择中选择Recovery mode模式，键盘按“e”键进入编辑模式。如下图，注意：不要先按enter键<br><img src="/images/virtual/ubuntn/password_2.png" alt=""><br>3、在编辑模式中通过上下键寻找到RO修改为RW模式(可写入恢复模式)。如下图，然后按crtl+X进入系统<br><img src="/images/virtual/ubuntn/password_3.png" alt=""><br>4、进行系统BIOS界面，通过上下键选择root命令行，点击enter键，如下图：<br><img src="/images/virtual/ubuntn/password_4.png" alt=""><br>5、使用passwd命令重新设定密码，例如 passwd rico(rico是系统中已忘记密码所对应的username)，回车确认；然后输入新密码并再次输入以确认新密码即可。若修改成功，则会看到密码设定成功提示：passwd: password updated successfully。最后，修改成功后，使用sudo reboot命令重启进入系统即可！<br><img src="/images/virtual/ubuntn/password_5.png" alt=""><br>输入过程密码是不可见，有些显示不完全，可忽略，继续操作！</p>
<p>6、重启后通过验证刚才修改的密码是否可用，如下图输入密码后回车能进入系统，说明修改成功。<br><img src="/images/virtual/ubuntn/password_6.png" alt=""><br>7、成功进入ubuntn kylin桌面，大功告成~~<br><img src="/images/virtual/ubuntn/password_7.png" alt=""></p>
<p>参考链接：<a href="https://blog.csdn.net/justloveyou_/article/details/78540990" target="_blank" rel="noopener" title="Ubuntn系统（虚拟机）忘记密码的解决方法">Ubuntn系统（虚拟机）忘记密码的解决方法</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/29/Centos7%20%E7%AB%AF%E5%8F%A3%E5%BC%80%E6%94%BE%E4%B8%8E%E9%98%B2%E7%81%AB%E5%A2%99%E8%AE%BE%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YouQiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秦音">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/29/Centos7%20%E7%AB%AF%E5%8F%A3%E5%BC%80%E6%94%BE%E4%B8%8E%E9%98%B2%E7%81%AB%E5%A2%99%E8%AE%BE%E7%BD%AE/" itemprop="url">Centos7 端口开放与防火墙设置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-29T10:28:57+08:00">
                2020-04-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Centos7/" itemprop="url" rel="index">
                    <span itemprop="name">Centos7</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Linux安装链接：<a href="https://www.cnblogs.com/newstart/p/10082272.html" target="_blank" rel="noopener" title="Red Hat Enterprse Linux 6操作系统">使用VMware新建Red Hat Enterprse Linux 6操作系统</a></p>
<p>VirtualBox下安装CentOS7链接：<a href="https://www.cnblogs.com/hihtml5/p/8217062.html" target="_blank" rel="noopener" title="VirtualBox下安装CentOS7系统">VirtualBox下安装CentOS7系统</a></p>
<h3 id="1-Centos7-端口开放及查看"><a href="#1-Centos7-端口开放及查看" class="headerlink" title="1.Centos7 端口开放及查看"></a>1.Centos7 端口开放及查看</h3><h4 id="1-1-开放-关闭端口"><a href="#1-1-开放-关闭端口" class="headerlink" title="1.1 开放|关闭端口"></a>1.1 开放|关闭端口</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 开放5672端口</span><br><span class="line">firewall-cmd --zone&#x3D;public --add-port&#x3D;5672&#x2F;tcp --permanent</span><br><span class="line"></span><br><span class="line">#关闭5672端口</span><br><span class="line">firewall-cmd --zone&#x3D;public --remove-port&#x3D;5672&#x2F;tcp --permanent</span><br><span class="line"></span><br><span class="line"># 配置立即生效，重载防火墙配置</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">#命令含义：</span><br><span class="line">--zone #作用域</span><br><span class="line">--add-port&#x3D;80&#x2F;tcp #添加端口，格式为：端口&#x2F;通讯协议</span><br><span class="line">--permanent #永久生效，没有此参数重启后失效</span><br></pre></td></tr></table></figure>
<h4 id="1-2-设置防火墙便于端口可供外部访问"><a href="#1-2-设置防火墙便于端口可供外部访问" class="headerlink" title="1.2 设置防火墙便于端口可供外部访问"></a>1.2 设置防火墙便于端口可供外部访问</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#查看防火墙所有开放的端口</span><br><span class="line">firewall-cmd --zone&#x3D;public --list-ports</span><br><span class="line"></span><br><span class="line">#查看防火墙状态</span><br><span class="line">firewall-cmd --state</span><br><span class="line"></span><br><span class="line">#关闭防火墙</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"></span><br><span class="line">#查看监听的端口</span><br><span class="line">netstat -lnpt</span><br><span class="line">#注意：centos7默认没有 netstat 命令，需要安装 net-tools 工具，命令为：</span><br><span class="line">yum install -y net-tools</span><br><span class="line"></span><br><span class="line">#检查端口被哪个进程占用</span><br><span class="line">netstat -lnpt |grep 5672</span><br></pre></td></tr></table></figure>

<h3 id="2-防火墙设置"><a href="#2-防火墙设置" class="headerlink" title="2.防火墙设置"></a>2.防火墙设置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#查看防火墙状态（not running表示防火墙关闭，running表示防火墙开启）</span><br><span class="line">firewall-cmd --state</span><br><span class="line"></span><br><span class="line">#查看防火墙已经开放的端口</span><br><span class="line">firewall-cmd --list-ports</span><br><span class="line">#如果防火墙已经关闭，则该命令显示：FirewallD is not running</span><br><span class="line"></span><br><span class="line">#重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h3 id="3-systemctl命令操作防火墙"><a href="#3-systemctl命令操作防火墙" class="headerlink" title="3.systemctl命令操作防火墙"></a>3.systemctl命令操作防火墙</h3><p>历史上，<a href="http://www.ruanyifeng.com/blog/2013/08/linux_boot_process.html" target="_blank" rel="noopener" title="Linux 的启动流程">Linux 的启动</a>一直采用init进程。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo &#x2F;etc&#x2F;init.d&#x2F;apache2 start</span><br><span class="line"># 或者</span><br><span class="line">$ service apache2 start</span><br></pre></td></tr></table></figure>
<p>这种方法有两个缺点。<br>&emsp;&emsp; 一是启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。<br>&emsp;&emsp; 二是启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。<br>&emsp;&emsp; Systemd 就是为了解决这些问题而诞生的。它的设计目标是，为系统的启动和管理提供一套完整的解决方案。字母d是守护进程（daemon）的缩写。 Systemd 这个名字的含义，就是它要守护整个系统。使用了 Systemd，就不需要再用init了。Systemd 取代了initd，成为系统的第一个进程（PID 等于 1），其他进程都是它的子进程。Systemd 并不是一个命令，而是一组命令，涉及到系统管理的方方面面。</p>
<p>参考链接：<a href="https://www.cnblogs.com/zwcry/p/9602756.html" target="_blank" rel="noopener" title="asd">linux systemctl 指令</a></p>
<p>systemctl是 Systemd 的主命令，用于管理系统。命令格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl 操作命令 服务名称</span><br></pre></td></tr></table></figure>
<p>以systemctl操作防火墙服务为例，其他服务类似，修改服务名称即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#启动防火墙服务</span><br><span class="line">systemctl start firewalld.service</span><br><span class="line"></span><br><span class="line">#关闭防火墙服务</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"></span><br><span class="line">#重启防火墙服务</span><br><span class="line">systemctl restart firewalld.service</span><br><span class="line"></span><br><span class="line">#查看防火墙的状态</span><br><span class="line">systemctl status firewalld.service</span><br><span class="line"></span><br><span class="line">#设置开机启动.  默认情况下，Centos7防火墙是打开的</span><br><span class="line">systemctl enable firewalld.service</span><br><span class="line"></span><br><span class="line">#设置开机时禁用防火墙服务</span><br><span class="line">systemctl disable firewalld.service</span><br><span class="line"></span><br><span class="line">#查看防火墙服务是否开机启动</span><br><span class="line">systemctl is-enabled firewalld.service;echo $?</span><br><span class="line"></span><br><span class="line">#查看已启动的服务列表</span><br><span class="line">systemctl list-unit-files|grep enabled</span><br></pre></td></tr></table></figure>
<h3 id="4-CentOS7和6的默认防火墙的区别"><a href="#4-CentOS7和6的默认防火墙的区别" class="headerlink" title="4.CentOS7和6的默认防火墙的区别"></a>4.CentOS7和6的默认防火墙的区别</h3><p>CentOS 7默认使用的是firewall作为防火墙，而CentOS 6使用iptables作为防火墙<br>如果需要设置Centos 7的防火墙为iptables，步骤如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 4.1 先关闭CentOS 7的防火墙</span><br><span class="line">systemctl stop firewalld.service #停止firewall</span><br><span class="line">systemctl disable firewalld.service #禁止firewall开机启动</span><br><span class="line"></span><br><span class="line"># 4.2 下载安装 iptables service服务</span><br><span class="line">yum -y install iptables-services</span><br><span class="line"></span><br><span class="line"># 4.3 如果要修改防火墙配置，如增加防火墙端口3306</span><br><span class="line">vi &#x2F;etc&#x2F;sysconfig&#x2F;iptables</span><br><span class="line">#增加规则</span><br><span class="line">-A INPUT -m state --state NEW -m tcp -p tcp --dport 3306 -j ACCEPT</span><br><span class="line">#保存退出后</span><br><span class="line"></span><br><span class="line"># 4.4 重启防火墙使配置生效</span><br><span class="line">systemctl restart iptables.service</span><br><span class="line"></span><br><span class="line"># 4.5 设置防火墙开机启动</span><br><span class="line">systemctl enable iptables.service</span><br><span class="line"></span><br><span class="line"># 4.6 最后重启系统使设置生效即可。</span><br><span class="line">#打开防火墙</span><br><span class="line">systemctl start iptables.service</span><br><span class="line"></span><br><span class="line">#关闭防火墙。解决主机不能访问虚拟机CentOS中的站点，前阵子在虚拟机上装好了CentOS6.2，并配好了apache+php+mysql，但是本机就是无法访问。（没遇到过这种情况）</span><br><span class="line">systemctl stop iptables.service</span><br></pre></td></tr></table></figure>




          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/24/Nginx%E5%AE%89%E8%A3%85%E4%B8%8E%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YouQiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秦音">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/24/Nginx%E5%AE%89%E8%A3%85%E4%B8%8E%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" itemprop="url">Nginx安装与常用命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-24T19:23:00+08:00">
                2020-04-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Nginx/" itemprop="url" rel="index">
                    <span itemprop="name">Nginx</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-nginx在服务器上安装"><a href="#1-nginx在服务器上安装" class="headerlink" title="1.nginx在服务器上安装"></a>1.nginx在服务器上安装</h3><p>&emsp;&emsp;在Centos下，yum源不提供nginx的安装，可以通过切换yum源的方法获取安装。也可以通过直接下载安装包的方法，<font color=red>以下命令均需root权限执行</font>.<br>&emsp;&emsp;首先安装必要的库（nginx 中gzip模块需要 zlib 库，rewrite模块需要 pcre 库，ssl 功能需要openssl库）。选定<font color=red>/usr/local</font>为安装目录，以下具体版本号根据实际改变。</p>
<h4 id="1-1-安装gcc-gcc-c-如新环境-未安装请先安装-已安装跳过，同下"><a href="#1-1-安装gcc-gcc-c-如新环境-未安装请先安装-已安装跳过，同下" class="headerlink" title="1.1 安装gcc gcc-c++(如新环境,未安装请先安装,已安装跳过，同下)"></a>1.1 安装gcc gcc-c++(如新环境,未安装请先安装,已安装跳过，同下)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y gcc gcc-c++</span><br></pre></td></tr></table></figure>
<h4 id="1-2-安装PCRE库"><a href="#1-2-安装PCRE库" class="headerlink" title="1.2 安装PCRE库"></a>1.2 安装PCRE库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">$ wget http:&#x2F;&#x2F;jaist.dl.sourceforge.net&#x2F;project&#x2F;pcre&#x2F;pcre&#x2F;8.33&#x2F;pcre-8.33.tar.gz</span><br><span class="line">$ tar -zxvf pcre-8.36.tar.gz</span><br><span class="line">$ cd pcre-8.36</span><br><span class="line">$ .&#x2F;configure</span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>如报错:</p>
<blockquote>
<p>configure: error: You need a C++ compiler for C++ support<br>解决:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc gcc-c++ </span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="1-3-安装SSL库"><a href="#1-3-安装SSL库" class="headerlink" title="1.3 安装SSL库"></a>1.3 安装SSL库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">$ wget http:&#x2F;&#x2F;www.openssl.org&#x2F;source&#x2F;openssl-1.0.1j.tar.gz</span><br><span class="line">$ tar -zxvf openssl-1.0.1j.tar.gz</span><br><span class="line">$ cd openssl-1.0.1j</span><br><span class="line">$ .&#x2F;config</span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h4 id="1-4-安装zlib库存"><a href="#1-4-安装zlib库存" class="headerlink" title="1.4 安装zlib库存"></a>1.4 安装zlib库存</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">$ wget http:&#x2F;&#x2F;zlib.net&#x2F;zlib-1.2.11.tar.gz</span><br><span class="line">$ tar -zxvf zlib-1.2.11.tar.gz</span><br><span class="line">$ .&#x2F;configure</span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h4 id="1-5-安装nginx"><a href="#1-5-安装nginx" class="headerlink" title="1.5 安装nginx"></a>1.5 安装nginx</h4><p>注意，此处根据个人想法是否修改nginx的安装路径。因为后期在添加nginx的jx.conf文件时是在nginx.conf中要配置的。默认情况下，配置文件nginx.conf放在/usr/local/nginx/conf, /etc/nginx或/usr/local/etc/nginx.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cd &#x2F;usr&#x2F;local&#x2F;</span><br><span class="line">$ wget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.8.0.tar.gz</span><br><span class="line">$ tar -zxvf nginx-1.8.0.tar.gz</span><br><span class="line">$ cd nginx-1.8.0</span><br><span class="line">$ .&#x2F;configure --user&#x3D;nobody --group&#x3D;nobody --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx --with-http_stub_status_module --with-http_gzip_static_module --with-http_realip_module --with-http_sub_module --with-http_ssl_module</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注: –with-http_ssl_module:这个不加后面在nginx.conf配置，ssl:on后,启动会报nginx: [emerg] unknown directive “ssl” in /opt/nginx/conf/nginx.conf 异常</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<p>如果提示以下错误：</p>
<blockquote>
<p>./configure: error: SSL modules require the OpenSSL library.<br>运行此命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install openssl openssl-devel </span><br></pre></td></tr></table></figure>
</blockquote>
<p>报错:</p>
<blockquote>
<p>./configure: error: the HTTP gzip module requires the zlib library<br>在–prefix后面接以下命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--with-pcre&#x3D;&#x2F;usr&#x2F;local&#x2F;pcre-8.36 指的是pcre-8.36 的源码路径。</span><br><span class="line">--with-zlib&#x3D;&#x2F;usr&#x2F;local&#x2F;zlib-1.2.8 指的是zlib-1.2.8 的源码路径。 </span><br></pre></td></tr></table></figure>
</blockquote>
<p>&emsp;&emsp;以上安装方法nginx的配置文件位于<code>/usr/local/nginx/conf/nginx.conf</code><br>Nginx配置文件常见结构的从外到内依次是「http」「server」「location」等等，缺省的继承关系是从外到内，也就是说内层块会自动获取外层块的值作为缺省值。</p>
<h4 id="1-6-启动"><a href="#1-6-启动" class="headerlink" title="1.6 启动"></a>1.6 启动</h4><p>&emsp;&emsp;根据上面的安装步骤，nginx 在服务器上安装后启动位置为：<code>/usr/local/nginx/sbin/nginx</code>，即直接运行该命令即可启动nginx。也可以修改指定配置文件地址，然后就可全局使用Nginx命令（个人理解）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#寻找含有nginx的文件:</span><br><span class="line">find &#x2F; -name nginx  </span><br><span class="line"></span><br><span class="line">#定位nginx文件位置:</span><br><span class="line">whereis nginx</span><br><span class="line"></span><br><span class="line">#指定配置文件地址(需要根据自己的nginx路径做相应的修改):</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -c &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf </span><br><span class="line"></span><br><span class="line">#重新加载nginx配置文件:</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>
<p>nginx的配置文件目录/usr/local/nginx/conf/nginx.conf中在http内添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name localhost;</span><br><span class="line"></span><br><span class="line">	location &#x2F; &#123;</span><br><span class="line">		proxy_pass http:&#x2F;&#x2F;localhost:8080;</span><br><span class="line">		proxy_redirect off;</span><br><span class="line">		proxy_set_header Host $host;</span><br><span class="line">		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">		proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-6-1-启动前准备"><a href="#1-6-1-启动前准备" class="headerlink" title="1.6.1 启动前准备"></a>1.6.1 启动前准备</h5><p>启动前先看它启动没有，通过linux命令查看所有端口，看看启动端口中有没有80端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -ntlp（查看端口情况）</span><br><span class="line">sudo systemctl status nginx（查看nginx服务情况）</span><br></pre></td></tr></table></figure>
<p>如果没有，则通过命令启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#启动：</span><br><span class="line">systemctl start nginx</span><br><span class="line"></span><br><span class="line">#停止：</span><br><span class="line">systemctl stop nginx</span><br><span class="line"></span><br><span class="line">#重启：</span><br><span class="line">systemctl restart nginx</span><br></pre></td></tr></table></figure>
<p>如果在启动时报错误（没报错跳过）：</p>
<blockquote>
<p>-bash: nginx: command not found<br>原因是没有将nginx配置到环境变量中（没报错跳过）<br>把nginx所在的目录加入系统变量中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#编辑系统环境变量文件</span><br><span class="line">vim &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">在文件最后添加：</span><br><span class="line">PATH&#x3D;$PATH:&#x2F;var&#x2F;local&#x2F;nginx&#x2F;sbin</span><br><span class="line"></span><br><span class="line">export PATH </span><br></pre></td></tr></table></figure>
<p><img src="/images/nginx/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#保存并退出，执行命令更新环境变量</span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line">#使配置文件生效,之后重启nginx</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx (路径下启动，没有找到nginx命令时通过该命令启动) </span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#设置nginx开启启动</span><br><span class="line">sudo chkconfig nginx on</span><br><span class="line"></span><br><span class="line">#关闭Centos自带的firewall防火墙</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"></span><br><span class="line">#禁止Firewall开机启动</span><br><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>
<p>然后在浏览器上访问：服务器的Ip（192.168.216.128）:80</p>
<h3 id="2-nginx安装启动后，宿主机无法访问nginx主页"><a href="#2-nginx安装启动后，宿主机无法访问nginx主页" class="headerlink" title="2.nginx安装启动后，宿主机无法访问nginx主页"></a>2.nginx安装启动后，宿主机无法访问nginx主页</h3><p>具体情况如下</p>
<blockquote>
<p>①本机能ping通虚拟机<br>②虚拟机也能ping通本机<br>③虚拟机能访问自己的web<br>④本机无法访问虚拟机的web</p>
</blockquote>
<p>&emsp;&emsp; 后来发现是防火墙将80端口屏蔽了的缘故。故检查是不是虚拟机的80端口被防火墙堵了，可以在宿主机通过命令：telnet 虚拟机Ip 80 来测试。如果能telnet通说明不是防火墙的问题，如果不能说明端口被堵住了。</p>
<p>解决方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#Centos6的防火墙为iptables，而Centos7的防火墙为firewall，根据自己的系统做对应修改</span><br><span class="line">&#x2F;sbin&#x2F;iptables -I INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line"></span><br><span class="line">#然后保存：</span><br><span class="line">&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;iptables save</span><br><span class="line"></span><br><span class="line">#重启防火墙</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;iptables restart</span><br><span class="line"></span><br><span class="line">#CentOS防火墙的关闭，关闭其服务即可</span><br><span class="line">#查看CentOS防火墙信息</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;iptables status</span><br><span class="line">#关闭CentOS防火墙服务</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;iptables stop</span><br></pre></td></tr></table></figure>

<h3 id="3-nginx所需常用命令"><a href="#3-nginx所需常用命令" class="headerlink" title="3.nginx所需常用命令"></a>3.nginx所需常用命令</h3><p>查看nginx进程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">（lsof命令是一个列出当前系统打开文件的工具，详细百度）</span><br><span class="line">sudo lsof -i：80</span><br><span class="line"># 或者</span><br><span class="line">ps -ef|grep nginx</span><br></pre></td></tr></table></figure>
<p>修改配置文件后，需要测试修改的配置文件是否合法，然后再重启nginx。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#测试修改是否合法：</span><br><span class="line">nginx -t</span><br><span class="line"></span><br><span class="line">#重启命令：</span><br><span class="line">nginx -s reload</span><br><span class="line">#或</span><br><span class="line">systemctl restart nginx</span><br><span class="line"></span><br><span class="line">#查看已经开放的端口：</span><br><span class="line">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure>
<p>开启端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;public --add-port&#x3D;80&#x2F;tcp --permanent</span><br></pre></td></tr></table></figure>
<blockquote>
<p>命令含义：<br>    –zone #作用域<br>    –add-port=80/tcp #添加端口，格式为：端口/通讯协议<br>    –permanent #永久生效，没有此参数重启后将失效</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">#停止firewall</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line"> </span><br><span class="line">#禁止firewall开机启动</span><br><span class="line">systemctl disable firewalld.service </span><br><span class="line"></span><br><span class="line">#查看默认防火墙状态（关闭后显示notrunning，开启后显示running）</span><br><span class="line">firewall-cmd --state</span><br></pre></td></tr></table></figure>
<h3 id="4-解决Nginx出现403-forbidden-13-Permission-denied-报错的四种方法"><a href="#4-解决Nginx出现403-forbidden-13-Permission-denied-报错的四种方法" class="headerlink" title="4. 解决Nginx出现403 forbidden (13: Permission denied)报错的四种方法"></a>4. 解决Nginx出现403 forbidden (13: Permission denied)报错的四种方法</h3><h4 id="4-1-由于启动用户和nginx工作用户不一致所致"><a href="#4-1-由于启动用户和nginx工作用户不一致所致" class="headerlink" title="4.1 由于启动用户和nginx工作用户不一致所致"></a>4.1 由于启动用户和nginx工作用户不一致所致</h4><p>查看nginx的启动用户，发现是nobody，而未是用root启动的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep &quot;nginx: worker process&quot; | awk&#39;&#123;print $1&#125;&#39;</span><br></pre></td></tr></table></figure>
<p>故将nginx.config的user改为和启动用户一致，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>
<p>该文件如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">user nginx;  #将nginx改为和启动用户一致</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  logs&#x2F;error.log;</span><br><span class="line">error_log  logs&#x2F;error.log  notice;</span><br><span class="line">error_log  logs&#x2F;error.log  info;</span><br><span class="line"></span><br><span class="line">pid        logs&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-缺少index-html或者index-php文件，就是配置文件中index-index-html-index-htm这行中的指定的文件。"><a href="#4-2-缺少index-html或者index-php文件，就是配置文件中index-index-html-index-htm这行中的指定的文件。" class="headerlink" title="4.2 缺少index.html或者index.php文件，就是配置文件中index index.html index.htm这行中的指定的文件。"></a>4.2 缺少index.html或者index.php文件，就是配置文件中index index.html index.htm这行中的指定的文件。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server &#123;  </span><br><span class="line">	listen       80;  </span><br><span class="line">	server_name  localhost; </span><br><span class="line">	index  index.php index.html;  </span><br><span class="line">	root  &#x2F;data&#x2F;www&#x2F;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果在/data/www/下面没有index.php,index.html的时候，直接文件，会报403 forbidden。</p>
<h4 id="4-3-权限问题，如果nginx没有web目录的操作权限，也会出现403错误。"><a href="#4-3-权限问题，如果nginx没有web目录的操作权限，也会出现403错误。" class="headerlink" title="4.3 权限问题，如果nginx没有web目录的操作权限，也会出现403错误。"></a>4.3 权限问题，如果nginx没有web目录的操作权限，也会出现403错误。</h4><p>解决办法：修改web目录的读写权限，或者是把nginx的启动用户改成目录的所属用户，重启Nginx即可解决</p>
<blockquote>
<p>chmod  777 /etc/squid 运行命令后，squid文件夹（目录）的权限就被修改为777（可读可写可执行）。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 777 &#x2F;data</span><br><span class="line">chmod -R 777 &#x2F;data&#x2F;www&#x2F;</span><br></pre></td></tr></table></figure>
<p>SELinux设置为开启状态（enabled）的原因。</p>
<h4 id="4-4-查看当前selinux的状态。"><a href="#4-4-查看当前selinux的状态。" class="headerlink" title="4.4 查看当前selinux的状态。"></a>4.4 查看当前selinux的状态。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;sbin&#x2F;sestatus</span><br></pre></td></tr></table></figure>
<p><img src="/images/nginx/%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8Dselinux%E7%9A%84%E7%8A%B6%E6%80%81.png" alt=""><br>将SELINUX=enforcing 修改为 SELINUX=disabled 状态。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;selinux&#x2F;config</span><br></pre></td></tr></table></figure>
<p><img src="/images/nginx/%E4%BF%AE%E6%94%B9selinux%E7%9A%84%E7%8A%B6%E6%80%81.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELINUX&#x3D;disabled</span><br></pre></td></tr></table></figure>
<p>重启生效。reboot。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure>



          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/24/ubuntu%E7%AB%AF%E5%8F%A3%E4%B8%8E%E9%98%B2%E7%81%AB%E5%A2%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YouQiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秦音">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/24/ubuntu%E7%AB%AF%E5%8F%A3%E4%B8%8E%E9%98%B2%E7%81%AB%E5%A2%99/" itemprop="url">ubuntu端口与防火墙</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-24T19:07:50+08:00">
                2020-04-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ubuntu/" itemprop="url" rel="index">
                    <span itemprop="name">ubuntu</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://help.ubuntu.com/" target="_blank" rel="noopener" title="ubuntu官网地址">ubuntu官网地址</a></p>
<p>ubuntu安装教程：<br><a href="https://blog.csdn.net/zxf1242652895/article/details/78203473" target="_blank" rel="noopener" title="VMware Tools （ubuntu系统）安装详细过程与使用">VMware Tools （ubuntu系统）安装详细过程与使用</a><br><a href="https://blog.csdn.net/stpeace/article/details/78598333" target="_blank" rel="noopener" title="VMware Ubuntu安装详细过程">VMware Ubuntu安装详细过程</a><br><a href="http://blog.itpub.net/25357621/viewspace-2665521/" target="_blank" rel="noopener" title="ubuntu-19.04-live-server-amd64虚拟机系统安装">ubuntu-19.04-live-server-amd64虚拟机系统安装</a></p>
<h3 id="1-ubuntu切换到root用户"><a href="#1-ubuntu切换到root用户" class="headerlink" title="1. ubuntu切换到root用户"></a>1. ubuntu切换到root用户</h3><p>如果在使用<code>su root</code>命令，去切换到root权限，此时会提示输入密码，但怎么也输不对，提示<code>&quot;Authentication failure&quot;</code>，此时有两种情况一个是真的是密码错了，另一种就是刚安装好的Linux系统，没有给root设置密码。<br>打开Ubuntu，输入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure>
<p>回车提示输入密码，怎么输入都不对。<br>给root用户设置密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure>
<p>输入密码，并确认密码。<br>重新输入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br></pre></td></tr></table></figure>
<p>然后输入密码,发现可以切换到root权限了。</p>
<h3 id="2-Ubuntu查看端口使用情况，使用netstat命令"><a href="#2-Ubuntu查看端口使用情况，使用netstat命令" class="headerlink" title="2. Ubuntu查看端口使用情况，使用netstat命令"></a>2. Ubuntu查看端口使用情况，使用netstat命令</h3><p>查看已经连接的服务端口（ESTABLISHED）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -a</span><br></pre></td></tr></table></figure>
<p>查看所有的服务端口（LISTEN，ESTABLISHED）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ap</span><br></pre></td></tr></table></figure>
<p>查看指定端口，可以结合grep命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ap | grep 8080</span><br></pre></td></tr></table></figure>
<blockquote>
<p>也可以使用lsof命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:8888 </span><br></pre></td></tr></table></figure>
</blockquote>
<p>查看本地端口开启情况(ubuntu下执行)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw status.</span><br></pre></td></tr></table></figure>
<p>打开80端口(ubuntu下执行)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw allow 80</span><br></pre></td></tr></table></figure>
<p>测试服务器的端口是否开启：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.13.128 80</span><br></pre></td></tr></table></figure>

<h3 id="3-ubuntu防火墙"><a href="#3-ubuntu防火墙" class="headerlink" title="3.ubuntu防火墙"></a>3.ubuntu防火墙</h3><p>ubuntu的防火墙名称为ufw，而centos服务器的防火墙名称为firewall</p>
<p>查看防火墙状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status ufw</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure>
<blockquote>
<p>inactive 状态是防火墙关闭状态<br>active 是开启状态。</p>
</blockquote>
<p>开启防火墙(ubuntu下执行)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw enable</span><br></pre></td></tr></table></figure>
<p>关闭防火墙:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop ufw</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw disable</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/09/Nginx%E4%BB%A3%E7%90%86%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YouQiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/touxiang.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="秦音">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/04/09/Nginx%E4%BB%A3%E7%90%86%E5%85%A5%E9%97%A8/" itemprop="url">Nginx代理入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-04-09T17:50:00+08:00">
                2020-04-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Nginx/" itemprop="url" rel="index">
                    <span itemprop="name">Nginx</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-nginx代理简单模型"><a href="#1-nginx代理简单模型" class="headerlink" title="1. nginx代理简单模型"></a>1. nginx代理简单模型</h3><p>在nginx.conf文件中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	#这里配置的是负载均衡的情况，即请求到了后会自动分配到<span class="number">81</span>和<span class="number">82</span>服务上（默认两个服务处理请求数量是<span class="number">1</span>:<span class="number">1</span>），可通过设置权重来实现每个服务处理不同数量的请求</span><br><span class="line">    upstream qinyin.com &#123;</span><br><span class="line">		server  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8081</span>;</span><br><span class="line">		server  <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8082</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	server&#123;</span><br><span class="line">		#监听<span class="number">8900</span> 端口</span><br><span class="line">		<span class="built_in">listen</span> <span class="number">8900</span>;</span><br><span class="line">		#监听地址，即监听域名</span><br><span class="line">		server_name localhost;</span><br><span class="line">		location / &#123;</span><br><span class="line">			proxy_pass        http:<span class="comment">//127.0.0.1:8081;</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		#如果有请求：localhost：<span class="number">8900</span>/qinyin ，则会自动代理到：http:<span class="comment">//127.0.0.1:8082/qinyin 路径下,有四种情况：</span></span><br><span class="line">		#① 【/qinyin】+【<span class="number">8082</span>】 = http:<span class="comment">//127.0.0.1:8082/qinyin/</span></span><br><span class="line">#		location /qinyin &#123;</span><br><span class="line">#			proxy_pass         http:<span class="comment">//127.0.0.1:8082;</span></span><br><span class="line">#		&#125;</span><br><span class="line"></span><br><span class="line">		#② 【/qinyin】+【<span class="number">8082</span>/】 = http:<span class="comment">//127.0.0.1:8082</span></span><br><span class="line">#		location /qinyin &#123;</span><br><span class="line">#			proxy_pass         http:<span class="comment">//127.0.0.1:8082/;</span></span><br><span class="line">#		&#125;</span><br><span class="line"></span><br><span class="line">		#③【/qinyin/】+【<span class="number">8082</span>】= http:<span class="comment">//127.0.0.1:8082/qinyin/</span></span><br><span class="line">#		location /qinyin/ &#123;</span><br><span class="line">#			proxy_pass         http:<span class="comment">//127.0.0.1:8082;</span></span><br><span class="line">#		&#125;</span><br><span class="line"></span><br><span class="line">		#④ 【/qinyin/】+【<span class="number">8082</span>/】= http:<span class="comment">//127.0.0.1:8082 。即proxy_pass 路径后有/ ，代理后就不会出现追加；</span></span><br><span class="line">		location /qinyin/ &#123;</span><br><span class="line">			proxy_pass         http:<span class="comment">//127.0.0.1:8082/;</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		#请求调整到负载均衡，即会nginx会自动将请求分配给不同的服务来处理</span><br><span class="line">		location /test/ &#123;</span><br><span class="line">			proxy_pass         http:<span class="comment">//qinyin.com/;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考文章：<a href="https://my.oschina.net/springMVCAndspring/blog/1811673" target="_blank" rel="noopener" title="window 下实现nginx 反向代理">window 下实现nginx 反向代理</a></p>
<h3 id="2-nginx前后端一次代理"><a href="#2-nginx前后端一次代理" class="headerlink" title="2. nginx前后端一次代理"></a>2. nginx前后端一次代理</h3><h4 id="2-1-nginx后端代理"><a href="#2-1-nginx后端代理" class="headerlink" title="2.1 nginx后端代理"></a>2.1 nginx后端代理</h4><p>后端代理，只需要匹配到关键词，然后代理到指定路径上即可，比如配置如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">listen</span> <span class="number">443</span>;</span><br><span class="line">server_name sf.aiidc.com.cn;</span><br><span class="line">ssl on;</span><br><span class="line">ssl_certificate /opt/xa/https/<span class="number">2593723</span>_sf.aiidc.com.cn.pem;</span><br><span class="line">ssl_certificate_key /opt/xa/https/<span class="number">2593723</span>_sf.aiidc.com.cn.key;</span><br><span class="line">ssl_session_timeout <span class="number">5</span>m;</span><br><span class="line">ssl_protocols SSLv2 SSLv3 TLSv1 TLSv1<span class="number">.2</span>;</span><br><span class="line">ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+<span class="literal">HIGH</span>:+MEDIUM:+<span class="literal">LOW</span>:+SSLv2:+EXP; </span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line">root /opt/xa/pcWeb;</span><br><span class="line"></span><br><span class="line">location /api/wszz/ &#123;</span><br><span class="line">	proxy_pass http:<span class="comment">//127.0.0.1:8083/;</span></span><br><span class="line">	proxy_set_header Host $host:$server_port;</span><br><span class="line">	proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">	proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">	client_max_body_size <span class="number">300</span>m;</span><br><span class="line">	proxy_connect_timeout <span class="number">300</span>s;</span><br><span class="line">	proxy_send_timeout <span class="number">300</span>s;</span><br><span class="line">	proxy_read_timeout <span class="number">300</span>s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 上面的配置意思为：监听域名sf.aiidc.com.cn的443端口的/api/wszz/路径，即监听<a href="http://sf.aiidc.com.cn:443/api/wszz/" target="_blank" rel="noopener">http://sf.aiidc.com.cn:443/api/wszz/</a> 请求，然后将请求代理到<a href="http://127.0.0.1:8083/" target="_blank" rel="noopener">http://127.0.0.1:8083/</a><br>即本机（127.0.0.1 IP表示本机）的8083端口服务上。即<a href="http://sf.aiidc.com.cn:443/api/wszz/file-note/getFileNote(浏览器发起请求)" target="_blank" rel="noopener">http://sf.aiidc.com.cn:443/api/wszz/file-note/getFileNote(浏览器发起请求)</a> == <a href="http://127.0.0.1:8083/file-note/getFileNote(服务器处理请求)" target="_blank" rel="noopener">http://127.0.0.1:8083/file-note/getFileNote(服务器处理请求)</a></p>
<h4 id="2-2-nginx前端代理"><a href="#2-2-nginx前端代理" class="headerlink" title="2.2 nginx前端代理"></a>2.2 nginx前端代理</h4><p>前端代理，既要匹配到关键词，还要部署到相应的目录里面才行，比如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">listen</span> <span class="number">443</span>;</span><br><span class="line">server_name sf.aiidc.com.cn;</span><br><span class="line">ssl on;</span><br><span class="line">ssl_certificate /opt/xa/https/<span class="number">2593723</span>_sf.aiidc.com.cn.pem;</span><br><span class="line">ssl_certificate_key /opt/xa/https/<span class="number">2593723</span>_sf.aiidc.com.cn.key;</span><br><span class="line">ssl_session_timeout <span class="number">5</span>m;</span><br><span class="line">ssl_protocols SSLv2 SSLv3 TLSv1 TLSv1<span class="number">.2</span>;</span><br><span class="line">ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+<span class="literal">HIGH</span>:+MEDIUM:+<span class="literal">LOW</span>:+SSLv2:+EXP; </span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line">root /opt/xa/pcWeb;</span><br><span class="line"></span><br><span class="line">location /api/wainao/ &#123;</span><br><span class="line">	proxy_pass http:<span class="comment">//127.0.0.1:8082/;</span></span><br><span class="line">	proxy_set_header Host $host:$server_port;</span><br><span class="line">	proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">	proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">	client_max_body_size <span class="number">10</span>m;</span><br><span class="line">	proxy_connect_timeout <span class="number">60</span>s;</span><br><span class="line">	proxy_send_timeout <span class="number">60</span>s;</span><br><span class="line">	proxy_read_timeout <span class="number">60</span>s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp; 上面的配置意思为：监听域名<a href="http://sf.aiidc.com.cn的443端口的/api/wainao/路径，" target="_blank" rel="noopener">http://sf.aiidc.com.cn的443端口的/api/wainao/路径，</a> 即监听<a href="http://sf.aiidc.com.cn:443/api/wainao/index.html" target="_blank" rel="noopener">http://sf.aiidc.com.cn:443/api/wainao/index.html</a> 请求,然后将请求代理到/opt/xa/pcWeb这个目录下面的index.html文件。<br>&emsp;&emsp; 而前端代理根本不需要ssl_xxxx这些Https配置，同时也不需要location，因为后端已经有了代理，而前端的请求会自动被后端的代理监听并处理，所以前端不需要指定location等配置。</p>
<h3 id="3-nginx前后端两次代理"><a href="#3-nginx前后端两次代理" class="headerlink" title="3. nginx前后端两次代理"></a>3. nginx前后端两次代理</h3><p>&emsp;&emsp; 场景：153服务器无法通过外网连接，只有局域网内的服务器（比如231）可以连通，那么项目部署就需要通过nginx代理过去。<br>&emsp;&emsp; 实现原理：将项目前后端在153服务器上部署好，并启动成功。然后通过用户请求231服务器，231服务器将请求代理到153上。<br>153服务器的nginx配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">listen 8600;</span><br><span class="line">	root &#x2F;opt&#x2F;parse&#x2F;web&#x2F;dimension&#x2F;;</span><br><span class="line"></span><br><span class="line">	location &#x2F;dimension&#x2F;api&#x2F; &#123;</span><br><span class="line">		proxy_pass http:&#x2F;&#x2F;127.0.0.1:8601&#x2F;;</span><br><span class="line">		proxy_set_header X-Forwarded-Prefix &#x2F;dimension&#x2F;api;</span><br><span class="line">		proxy_set_header Host $host:$server_port;</span><br><span class="line">		proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">		proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">		client_max_body_size 10m;</span><br><span class="line">		proxy_connect_timeout 60s;</span><br><span class="line">		proxy_send_timeout 60s;</span><br><span class="line">		proxy_read_timeout 60s;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>231服务器上的nginx配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 8600;</span><br><span class="line">	root &#x2F;opt&#x2F;parse&#x2F;web&#x2F;dimension&#x2F;; </span><br><span class="line"></span><br><span class="line">	#前端配置，前端请求（http:&#x2F;&#x2F;172.16.16.231:8600&#x2F;dimension&#x2F;api&#x2F;user&#x2F;login）后代理153服务器的根目录上，在通过153的root定位index.html页面</span><br><span class="line">	location &#x2F; &#123;</span><br><span class="line">		proxy_pass http:&#x2F;&#x2F;172.16.16.153:8600&#x2F;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	#后端配置，请求过来后跳转到153的后端监听项（&#x2F;dimension&#x2F;api&#x2F;），定位到153的后端服务</span><br><span class="line">	location &#x2F;dimension&#x2F;api&#x2F; &#123;</span><br><span class="line">		proxy_pass http:&#x2F;&#x2F;172.16.16.153:8600&#x2F;dimension&#x2F;api&#x2F;;</span><br><span class="line">		proxy_set_header X-Forwarded-Prefix &#x2F;dimension&#x2F;api;</span><br><span class="line">		proxy_set_header Host $host:$server_port;</span><br><span class="line">		proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">		proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">		client_max_body_size 10m;</span><br><span class="line">		proxy_connect_timeout 60s;</span><br><span class="line">		proxy_send_timeout 60s;</span><br><span class="line">		proxy_read_timeout 60s;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>①只有前端代理才需要考虑目录问题，后端代理不需要考虑目录，即部署的位置问题；<br>②在代理的时候，listen监听的端口需要开放并没有被其他程序使用，否则此代理文件不会生效。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/touxiang.png"
                alt="YouQiang" />
            
              <p class="site-author-name" itemprop="name">YouQiang</p>
              <p class="site-description motion-element" itemprop="description">技术总结</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yourname" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YouQiang</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
